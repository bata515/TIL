# Web API The Good Parts を読んで学んだこと
この書籍を読んで、今までの経験と照らし合わせて、Web APIの設計や実装に関する知識で初めて知った内容をまとめます。

## 1章　Web APIとは何か

### Web APIの重要性
自分たちで作成した機能やでーたをAPIとして公開するということは、近視眼的に見れば損しているようにも見えるが、そのAPIから新しいシステム、サービスを公開する力を持った開発者に公開することでサービスに付加価値を与えてくれて自分たちのサービスが発展する力をもらうこともできる。

拡張機能やアフィリエイト広告などもAPIを使ったサービスの横展開で、例えばAmazonnの商品リンクをアプリやブログに組み込むことで、自分でECサイトの構築や在庫の用意はしなくても、商品を販売し一部の利益がもらえるようになる。
またAmazonは自社サービスの発展につながる。

## 2章 エンドポイントの設計とリクエストの形式

### エンドポイントの基本的な設計
1. 短く入力しやすいURI
    同じ単語や表現はなくし、理解しやすく、短く、入力しやすいURIを心がける。
2. 人間が呼んで理解できるURI
    略語などは使用せずに、誰が見ても理解できるURIを心がける。和製英語やローマ字表記も避け全世界共通の正しい英語を使用してURIを表現するのが好ましい。
3. 大文字、小文字が混在していないURI
4. 改造しやすい(Hackable)URI
5. サーバー側のアーキテクチャが反映されていないURI
6. ルールが統一されたURI

### X-HTTP-Method-Override ヘッダ
HTTPメソッドを上書きするためのヘッダで、POSTリクエストに対してPUTやDELETEなどのメソッドを指定することができる。
HTMLフォームではGETとPOSTしか使用できないため、PUTやDELETEを使用したい場合にこのヘッダを使用する。
#### 例
```http
POST /api/resource HTTP/1.1
Host: example.com
Content-Type: application/json
{
  "name": "example"
}
X-HTTP-Method-Override: PUT
```

クライアント側ソースコードでの指定方法例
JavaScript（Fetch API）の場合：
```javascript
fetch('/api/resource', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-HTTP-Method-Override': 'PUT'
  },
  body: JSON.stringify({
    name: 'example'
  })
  });
```
まとめ
- クライアント開発時に使用している一部のライブラリ、HTMLフォームはGET、POSTのみしか対応していない場合があり、 PUT や DELETE を直接送れないことがある

- サーバー側で X-HTTP-Method-Override を検知して、元のリクエストメソッドを「上書き」する

### クエリパラメータとパスパラメータの使い分け
- パスパラメータは、一意なリソースを識別するために使用される。
例えば、ユーザー情報を取得するAPIで、特定のユーザーの情報を取得する場合、パスパラメータを使用してユーザーIDを指定する。
```http
GET /api/users/{userId}
```
- クエリパラメータは、リソースのフィルタリングやソート、ページネーションなどに使用される。
例えば、ユーザー情報の一覧を取得する場合は、クエリパラメータを使用してフィルタリングやソートを行う。
```http
GET /api/users?sort=name&filter=active
``` 

### 検索とクエリパラメータの設計
#### 取得数と取得位置のクエリパラメータ
- limit/offset
  - `limit`：取得するアイテムの最大数を指定する。
  - `offset`：取得するアイテムの開始位置を指定する。
- per_page/page
  - `per_page`：1ページあたりのアイテム数を指定する。
  - `page`：ページネーションを行うためのページ番号を指定する。

#### 例
```http
GET /api/items?limit=10&offset=20
GET /api/items?per_page=10&page=3
```

limit/offsetとper_page/pageのどちらを使うかは好みによるが、一般的にはlimit/offsetの方が自由度が高いのでユーザーにとっては使いやすい場合がある。

例えば、上記の例でいうと、limit/offsetを使うと、15件目から10件取得するという開始位置の変更がが簡単に行えるが、per_page/pageを使うと、3ページ目を取得するためには、1ページあたりのアイテム数を考慮する必要があるため難しい。

#### 絶対位置でデータを取得
- 相対位置を利用する問題点
  - データの追加や削除が行われた場合、取得するデータの位置が変わる可能性がある。
  - レコードの先頭から位置を確認するため、データの量が多い場合、パフォーマンスに影響を与える可能性がある。
- 絶対位置を利用するメリット
  - 先頭から数えて何番目といいうようなものではなく、指定したIDよりも前、あるいは指定した日時よりも前、といった方法で指定を行うことができるため、データの追加や削除が行われても、安定して想定したデータの取得が可能となる。